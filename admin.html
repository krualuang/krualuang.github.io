<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üõ†Ô∏è Admin Tool | ‡∏Ñ‡∏£‡∏±‡∏ß‡∏´‡∏•‡∏ß‡∏á Menu Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
    /* --------------------------------- */
    /* 1. Global & Layout CSS */
    /* --------------------------------- */
    :root {
        --primary-color: #b8860b; /* DarkGoldenrod */
        --secondary-color: #1e88e5; /* Blue */
        --danger-color: #a00;
        --success-color: #2c974b;
        --bg-light: #f6f6f6;
        --bg-dark: #222;
        --text-color: #222;
        --text-light: #fff;
    }
    body {
        font-family: 'Prompt', sans-serif;
        margin: 0;
        background: var(--bg-light);
        color: var(--text-color);
        line-height: 1.6;
    }
    header {
        background: var(--primary-color);
        color: var(--text-light);
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    header h1 { margin: 0; font-size: 1.3rem; }
    .container {
        max-width: 1100px;
        margin: 30px auto;
        padding: 30px;
        background: var(--text-light);
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }
    h2, h3 { color: var(--text-color); border-bottom: 1px solid #eee; padding-bottom: 5px; }
    h2 { margin-top: 0; }
    
    /* --------------------------------- */
    /* 2. Form & Controls */
    /* --------------------------------- */
    .row {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }
    .col { flex: 1; min-width: 250px; }
    label { display: block; font-weight: 600; margin-bottom: 8px; color: #555; }
    input[type=text], input[type=number], textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-family: 'Prompt', sans-serif;
        box-sizing: border-box;
        margin-bottom: 5px;
    }
    button {
        background: var(--primary-color);
        color: var(--text-light);
        border: none;
        padding: 10px 18px;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.2s;
        font-weight: 600;
    }
    button:hover { filter: brightness(1.1); }
    .btn-secondary { background: #777; }
    .btn-danger { background: var(--danger-color); }
    .btn-primary { background: var(--primary-color); }
    .btn-success { background: var(--success-color); }
    .controls { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
    .note { font-size: 0.9rem; color: #777; margin-top: 5px; }
    
    /* --------------------------------- */
    /* 3. Login Box */
    /* --------------------------------- */
    .login-box {
        max-width: 360px;
        margin: 60px auto;
        padding: 30px;
        background: var(--text-light);
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        text-align: center;
    }
    .login-box h3 { border-bottom: none; }

    /* --------------------------------- */
    /* 4. Menu List */
    /* --------------------------------- */
    .menu-list h3 { margin-bottom: 15px; margin-top: 30px; }
    .menu-item {
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #eee;
        background: #fafafa;
        margin-bottom: 15px;
        display: flex;
        gap: 15px;
        align-items: flex-start;
        transition: box-shadow 0.2s;
    }
    .menu-item:hover { box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); }
    .menu-item img {
        width: 120px;
        height: 90px;
        object-fit: cover;
        border-radius: 8px;
        flex-shrink: 0;
    }
    .menu-item-content { flex-grow: 1; }
    .menu-item-content strong { color: var(--primary-color); font-weight: 700; }
    .small { font-size: 0.9rem; color: #666; }
    
    /* --------------------------------- */
    /* 5. Generator Section */
    /* --------------------------------- */
    #menu-generator {
        background: #fcfcfc;
        border: 1px dashed #ddd;
        padding: 25px;
        border-radius: 10px;
        margin-top: 30px;
    }
    #generatedKeys {
        background: var(--bg-dark);
        color: #00ff6a; /* Neon Green */
        padding: 15px;
        border-radius: 8px;
        white-space: pre-wrap;
        margin-top: 15px;
        font-size: 0.9rem;
        overflow-x: auto;
    }
    #menuPreview .menu-item { 
        max-width: 450px; 
        margin: 15px auto; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

</style>
</head>
<body>

<header>
    <h1>üõ†Ô∏è Admin Tool | ‡∏Ñ‡∏£‡∏±‡∏ß‡∏´‡∏•‡∏ß‡∏á</h1>
    <a href="index.html" style="color:var(--text-light);text-decoration:none;font-weight:600;opacity:0.8;">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
</header>

<div id="loginWrap" class="login-box">
    <h3>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h3>
    <div style="margin-top:15px">
        <label for="pin">PIN 4 ‡∏´‡∏•‡∏±‡∏Å</label>
        <input id="pin" type="text" placeholder="‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: 1234">
        <div class="controls" style="justify-content:center;margin-top:20px;">
            <button id="btnLogin" class="btn-primary">üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <button id="btnUseDemo" class="btn-secondary">‡∏ó‡∏î‡∏•‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô)</button>
        </div>
        <p class="note" style="margin-top:15px;">**‡∏Ñ‡πà‡∏≤ PIN ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ñ‡∏∑‡∏≠ **1234** (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î)</p>
    </div>
</div>

<div id="adminUI" class="container" style="display:none">
    
    <h2>1. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å (Local Storage Manager)</h2>

    <div class="row">
        <div class="col">
            <label for="menuName">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</label>
            <input id="menuName" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏¢‡∏Å‡∏∏‡πâ‡∏á‡∏™‡∏î">
        </div>
        <div class="col">
            <label for="menuPrice">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
            <input id="menuPrice" type="number" placeholder="120">
        </div>
        <div style="flex:1 1 100%">
            <label for="menuDesc">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label>
            <textarea id="menuDesc" rows="2" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏°‡∏ô‡∏π"></textarea>
        </div>
        <div class="col">
            <label for="menuImage">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)</label>
            <input id="menuImage" type="text" placeholder="images/menu/pad_thai.jpg">
        </div>

        <div class="controls">
            <button id="addBtn" class="btn-success">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏ô‡∏π</button>
            <button id="clearBtn" class="btn-secondary">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
        </div>
    </div>

    <hr style="border:0;border-top:1px solid #eee;margin:30px 0;">

    <section id="menu-generator">
        <h2>2. üßë‚Äçüç≥ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏µ‡∏¢‡πå‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h2>
        <p class="note">‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏µ‡∏¢‡πå `menu.itemX` ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å JSON ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå **`translations.js`** ‡πÄ‡∏≠‡∏á)</p>

        <div class="row">
            <div class="col">
                <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π (‡πÑ‡∏ó‡∏¢):</label>
                <input type="text" id="menuNameTh" placeholder="‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏¢‡∏Å‡∏∏‡πâ‡∏á‡∏™‡∏î">
            </div>
            <div class="col">
                <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡πÑ‡∏ó‡∏¢):</label>
                <textarea id="menuDescTh" rows="2" placeholder="‡πÄ‡∏™‡πâ‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡πå‡∏ú‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ã‡∏≠‡∏™‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©"></textarea>
            </div>
        </div>

        <div class="row" style="margin-top:15px;">
            <div class="col">
                <label>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó):</label>
                <input type="number" id="menuPriceTh" placeholder="60">
            </div>
            <div class="col">
                <label>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå):</label>
                <input type="text" id="menuImageGen" placeholder="padthai.jpg">
            </div>
        </div>
        
        <div class="controls" style="margin-top:20px;">
            <button id="generateMenuBtn" class="btn-secondary">‚öôÔ∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤</button>
            <button id="copyJsonBtn" class="btn-success" style="display:none;">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î JSON</button>
        </div>

        <h3 style="margin-top:30px;">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå JSON:</h3>
        <pre id="generatedKeys"></pre>
        <h3 style="margin-top:20px;">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Preview:</h3>
        <div id="menuPreview"></div>
    </section>

    <hr style="border:0;border-top:1px solid #eee;margin:30px 0;">

    <h2 style="margin-top:30px;">3. ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ Import/Export</h2>
    <div class="controls">
        <button id="saveLocal" class="btn-primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (localStorage)</button>
        <button id="downloadJson" class="btn-secondary">‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î menu.json</button>
        <input id="fileIn" type="file" style="display:none" accept="application/json">
        <button id="uploadJson" class="btn-secondary">‚¨ÜÔ∏è ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ menu.json</button>
    </div>

    <div class="menu-list" id="menuListWrap">
        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô localStorage</h3>
        <div id="menuList"></div>
    </div>

</div>


<script>
    /* ==========================================================
       CONFIG
       ========================================================== */
    const ADMIN_PIN = '1234'; 
    const STORAGE_KEY = 'krualuang_menu_v1';
    // üö® ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤ translations object ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÉ‡∏ä‡πâ Generator)
    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Standalone Admin ‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î Translations ‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô
    const translations = {
        th: {
            "menu.item1.name": "‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏¢",
            "menu.item1.desc": "‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏¢‡∏Å‡∏∏‡πâ‡∏á‡∏™‡∏î",
            "menu.item1.price": "120 ‡∏ö‡∏≤‡∏ó",
        },
        en: {}, la: {}, zh: {}
    };
    const DEFAULT_MENU = []; // ‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

    /* ==========================================================
       HELPER FUNCTIONS
       ========================================================== */
    function loadMenuFromLocal(){
        try{
            const raw = localStorage.getItem(STORAGE_KEY);
            return raw ? JSON.parse(raw) : DEFAULT_MENU.slice();
        }catch(e){ return DEFAULT_MENU.slice(); }
    }
    function saveMenuToLocal(arr){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(arr, null, 2));
    }
    function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function escapeAttr(s){ return (s||'').replaceAll('"','&quot;'); }

    /* ------------------------------------
       Google Translate API (Free)
       ------------------------------------ */
    async function translateText(text, targetLang) {
        if (!text) return '';
        try {
            const res = await fetch(
                `https://translate.googleapis.com/translate_a/single?client=gtx&sl=th&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`
            );
            const data = await res.json();
            return data[0][0][0];
        } catch (e) {
            console.warn("‚ùå ‡πÅ‡∏õ‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", e);
            return `[${targetLang.toUpperCase()}] ${text}`;
        }
    }

    /* ==========================================================
       UI LOGIC (RENDER & HANDLERS)
       ========================================================== */
    let menu = loadMenuFromLocal();
    const menuList = document.getElementById('menuList');
    const nameInput = document.getElementById('menuName');
    const descInput = document.getElementById('menuDesc');
    const priceInput = document.getElementById('menuPrice');
    const imageInput = document.getElementById('menuImage');

    function render(){
        menuList.innerHTML = '';
        if(!menu.length){ menuList.innerHTML = '<p class="small">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π</p>'; return; }
        
        menu.forEach((it, idx) => {
            const el = document.createElement('div');
            el.className = 'menu-item';
            el.innerHTML = `
                ${it.image ? `<img src="${escapeAttr(it.image)}" alt="${escapeHtml(it.name)}">` : ''}
                <div class="menu-item-content">
                    <strong>${escapeHtml(it.name||'')}</strong>
                    <div class="small">${escapeHtml(it.desc||'')}</div>
                    <div style="margin-top:8px">‡∏£‡∏≤‡∏Ñ‡∏≤: <strong>${Number(it.price||0)} ‡∏ö‡∏≤‡∏ó</strong></div>
                    <div style="margin-top:8px" class="controls">
                        <button data-edit="${idx}" class="btn-primary" style="padding: 5px 10px;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button data-delete="${idx}" class="btn-danger" style="padding: 5px 10px;">‡∏•‡∏ö</button>
                    </div>
                </div>
            `;
            menuList.appendChild(el);
        });
    }

    function clearForm(){
        nameInput.value='';
        descInput.value='';
        priceInput.value='';
        imageInput.value='';
    }

    // --- Handlers ---
    document.getElementById('addBtn').addEventListener('click', () => {
        const name = nameInput.value.trim();
        const desc = descInput.value.trim();
        const price = priceInput.value.trim();
        const image = imageInput.value.trim();
        if(!name || !price){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤'); return; }
        menu.push({name, desc, price: Number(price), image});
        saveMenuToLocal(menu);
        render();
        clearForm();
        alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
    });

    document.getElementById('clearBtn').addEventListener('click', clearForm);

    // Edit / Delete Delegation
    menuList.addEventListener('click', (ev)=>{
        const edit = ev.target.getAttribute('data-edit');
        const del = ev.target.getAttribute('data-delete');
        if(edit!=null){
            const idx = Number(edit);
            const it = menu[idx];
            // Load data to form
            nameInput.value = it.name;
            descInput.value = it.desc;
            priceInput.value = it.price;
            imageInput.value = it.image||'';
            // Remove original item (so 'Add' button becomes 'Save')
            menu.splice(idx,1);
            render();
            saveMenuToLocal(menu);
            alert('‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡∏ö');
        } else if(del!=null){
            if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')){
                menu.splice(Number(del),1);
                render();
                saveMenuToLocal(menu);
                alert('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            }
        }
    });

    // Save / Download / Upload
    document.getElementById('saveLocal').addEventListener('click', ()=> {
        saveMenuToLocal(menu);
        alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    });

    document.getElementById('downloadJson').addEventListener('click', ()=> {
        const blob = new Blob([JSON.stringify(menu, null, 2)], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'menu.json';
        document.body.appendChild(a); a.click();
        a.remove(); URL.revokeObjectURL(url);
    });

    document.getElementById('uploadJson').addEventListener('click', ()=> {
        document.getElementById('fileIn').click();
    });
    document.getElementById('fileIn').addEventListener('change', (e)=>{
        const f = e.target.files[0];
        if(!f) return;
        const r = new FileReader();
        r.onload = () => {
            try {
                const data = JSON.parse(r.result);
                if(!Array.isArray(data)) throw new Error('‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô array ‡∏Ç‡∏≠‡∏á‡πÄ‡∏°‡∏ô‡∏π');
                if(!confirm(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ ${data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π (‡∏à‡∏∞‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô) ?`)) return;
                menu = data;
                saveMenuToLocal(menu);
                render();
                alert('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            } catch(err){ alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ' + err.message); }
        };
        r.readAsText(f);
    });

    /* ==========================================================
       MENU GENERATOR LOGIC
       ========================================================== */
    const generatorBtn = document.getElementById("generateMenuBtn");
    const generatorOutput = document.getElementById("generatedKeys");
    const generatorCopyBtn = document.getElementById("copyJsonBtn");
    const generatorPreview = document.getElementById("menuPreview");
    
    // Generator Inputs (‡πÉ‡∏ä‡πâ ID ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô HTML)
    const genNameInput = document.getElementById("menuNameTh");
    const genDescInput = document.getElementById("menuDescTh");
    const genPriceInput = document.getElementById("menuPriceTh");
    const genImageInput = document.getElementById("menuImageGen");

    generatorBtn.addEventListener("click", async () => {
        const nameTh = genNameInput.value.trim();
        const descTh = genDescInput.value.trim();
        const priceTh = genPriceInput.value.trim();
        const img = genImageInput.value.trim();

        if (!nameTh || !descTh || !priceTh) {
            alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤ (‡πÑ‡∏ó‡∏¢)");
            return;
        }
        
        generatorPreview.innerHTML = "<p style='text-align:center;'>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤...</p>";
        generatorOutput.textContent = ""; 
        generatorCopyBtn.style.display = "none";

        // üîπ ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏°‡∏ô‡∏π‡∏ñ‡∏±‡∏î‡πÑ‡∏õ (‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å translations object ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà)
        // Note: ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ translations object ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
        const existingKeys = Object.keys(translations.th).filter(k => k.startsWith("menu.item") && k.endsWith(".name"));
        const nextIndex = existingKeys.length + 1; 
        const keyBase = `menu.item${nextIndex}`;

        // üîπ ‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        const [nameLa, nameEn, nameZh, descLa, descEn, descZh] = await Promise.all([
            translateText(nameTh, "lo"),
            translateText(nameTh, "en"),
            translateText(nameTh, "zh-CN"),
            translateText(descTh, "lo"),
            translateText(descTh, "en"),
            translateText(descTh, "zh-CN")
        ]);

        // üîπ ‡∏™‡∏£‡πâ‡∏≤‡∏á key
        const newKeys = {
            th: { [`${keyBase}.name`]: nameTh, [`${keyBase}.desc`]: descTh, [`${keyBase}.price`]: `${priceTh} ‡∏ö‡∏≤‡∏ó` },
            en: { [`${keyBase}.name`]: nameEn, [`${keyBase}.desc`]: descEn, [`${keyBase}.price`]: `${priceTh} Baht` },
            la: { [`${keyBase}.name`]: nameLa, [`${keyBase}.desc`]: descLa, [`${keyBase}.price`]: `${priceTh} ‡∫Å‡∫µ‡∫ö` },
            zh: { [`${keyBase}.name`]: nameZh, [`${keyBase}.desc`]: descZh, [`${keyBase}.price`]: `${priceTh} Ê≥∞Èì¢` }
        };

        // üö® ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï translations object ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Generator ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä)
        Object.keys(newKeys).forEach(lang => {
            Object.assign(translations[lang], newKeys[lang]);
        });
        
        generatorOutput.textContent = JSON.stringify(newKeys, null, 2);

        // üîπ ‡πÅ‡∏™‡∏î‡∏á preview
        generatorPreview.innerHTML = `
            <div class="menu-item" style="max-width:400px;margin:20px auto;">
                ${img ? `<img src="${img}" alt="${nameTh}">` : ''}
                <div class="menu-item-content">
                    <h4 style="margin:0;font-size:1.1rem;">${nameTh} (Key: ${keyBase})</h4>
                    <p class="small" style="margin:5px 0;">${descTh}</p>
                    <div style="font-weight:bold;color:var(--primary-color);">${priceTh} ‡∏ö‡∏≤‡∏ó</div>
                </div>
            </div>
        `;

        // üö® ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
        genNameInput.value = ''; genDescInput.value = ''; genPriceInput.value = ''; genImageInput.value = '';

        generatorCopyBtn.style.display = "inline-block"; 
        alert("‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!\n‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å JSON ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå translations.js");
    });

    generatorCopyBtn.addEventListener("click", () => {
        const jsonText = generatorOutput.textContent;
        if (!jsonText.trim()) { alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å"); return; }
        
        if (navigator.clipboard) {
            navigator.clipboard.writeText(jsonText).then(() => {
                generatorCopyBtn.textContent = "‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!";
                setTimeout(() => (generatorCopyBtn.textContent = "üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î JSON"), 1500);
            });
        }
    });

    /* ==========================================================
       LOGIN LOGIC
       ========================================================== */
    const loginWrap = document.getElementById('loginWrap');
    const adminUI = document.getElementById('adminUI');
    const pinInput = document.getElementById('pin');

    function handleLogin(){
        const v = (pinInput.value||'').trim();
        if(v === ADMIN_PIN){
            loginWrap.style.display='none';
            adminUI.style.display='block';
            render();
            alert('‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö!');
        } else {
            alert('PIN ‡∏ú‡∏¥‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
        }
    }

    document.getElementById('btnLogin').addEventListener('click', handleLogin);
    pinInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') handleLogin();
    });

    document.getElementById('btnUseDemo').addEventListener('click', ()=>{
        if(confirm('‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')){
            loginWrap.style.display='none';
            adminUI.style.display='block';
            render();
        }
    });
    
    // Initial render call must be after UI is shown
    // but the array load happens at the top.
    // We only call render() after successful login.
</script>

</body>
</html>
